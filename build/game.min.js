function EnemyDef(a){this.name=a.name||"Enemy",this.displayName=a.displayName||"Enemy",this.image=a.image||"img/Shroomie.png",this.minLevel=a.minLevel||0,this.health=a.health||10,this.attack=a.attack||5,this.xp=a.xp||3,this.gold=a.gold||1,this.forge=a.forge||1}function EnemyContainer(a){this.index=a,this.level=0,this.def=null,this.health=0,this.maxHealth=0,this.attack=0,this.xp=0,this.gold=0,this.x=0,this.y=0,this.getHtml=function(){return'<div class="enemy-container" index='+this.index+'><div class="name"></div><div class="health-background"><div class="health-foreground enemy-health-'+this.index+'"></div></div><div><img class="enemy" draggable="false" index="'+this.index+'" /></div></div>'},this.selector=null,this.getSelector=function(){return this.selector||(this.selector=$(".enemy-container[index="+this.index+"]")),this.selector},this.isActive=function(){return EnemyManager.activeEnemies.indexOf(this)>=0},this.respawn=function(a){this.level=EnemyManager.curArea.getLevel(EnemyManager.subArea);var b=this.level/3,c=(b+.5)/1.5,d=b;this.def=a,this.maxHealth=Math.floor(a.health*c),this.health=this.maxHealth,this.attack=Math.floor(a.attack*c),this.xp=Math.ceil(a.xp*Math.pow(d,1.6)),this.gold=Math.ceil(rand(.5,1)*a.gold*Math.pow(d,1.9)),this.forge=Math.ceil(a.forge*Math.pow(d,.8));var e=this.getSelector();e.find(".enemy").attr("src",a.image),e.find(".name").text("L"+this.level+" "+a.displayName);var f=e.width(),g=e.height(),h=30,i=EnemyManager.jqField,j=i.width(),k=i.height();this.x=rand(h,j-f-h)/j,this.y=rand(h,k-g-h)/k,this.updatePosition(),this.updateHealthBar()},this.getRelativePosition=function(){var a=EnemyManager.jqField;return{x:a.width()*this.x,y:a.height()*this.y}},this.getAbsolutePosition=function(){var a=EnemyManager.jqAdventure.position(),b=this.getRelativePosition();return{x:a.left+b.x,y:a.top+b.y}},this.updatePosition=function(){var a=this.getRelativePosition();this.getSelector().css({left:a.x+"px",top:a.y+"px"})},this.attackPower=function(){return this.attack},this.onClick=function(){var a=this.attackPower();this.isActive()&&Player.takeDamage(a)&&this.takeDamage(Player.getDamageInfo())},this.takeDamage=function(a){this.health-=a.damage;var b=this.getSelector(),c=b.width(),d=b.height(),e=this.getAbsolutePosition(),f=e.x+randInt(-40,40)+c/2,g=e.y+randInt(-20,0)+d/2,h=formatNumber(a.damage);if(a.isCrit?ParticleContainer.create(critParticleType,h+"!",f,g):ParticleContainer.create(damageParticleType,h,f,g),this.health<=0)this.giveRewards(),this.selector.find(".enemy").toggleClass("blur",!1),EnemyManager.despawnEnemy(this);else{this.animateHealthBar();var i=this.getSelector().find(".enemy");i.toggleClass("blur",!0).one("transitionend",function(){i.toggleClass("blur",!1)})}},this.getHealthPercent=function(){return 100*clamp(this.health/this.maxHealth,0,1)},this.animateHealthBar=function(){$(".enemy-health-"+this.index).stop(!0,!1).animate({width:this.getHealthPercent()+"%"},125)},this.updateHealthBar=function(){$(".enemy-health-"+this.index).stop(!0,!0).css("width",this.getHealthPercent()+"%")},this.giveRewards=function(){Player.xp+=this.xp,Player.gold+=this.gold,Player.forge+=this.forge;var a='<span class="xp-reward">'+getIconHtml("xp")+" "+formatNumber(this.xp)+'</span><br /><span class="gold-reward">'+getIconHtml("gold")+" "+formatNumber(this.gold)+'</span><br /><span class="forge-reward">'+getIconHtml("forge")+" "+formatNumber(this.forge)+"</span>",b=this.getAbsolutePosition();ParticleContainer.create(rewardParticleType,a,b.x,b.y)},this.handleResize=function(a){this.x*=a.width/Game.windowSize.width,this.y*=a.height/Game.windowSize.height,this.updatePosition()}}function ItemDef(a){this.toSave=["count","isResearched"],this.name=a.name||"",this.displayName=a.displayName||a.name||"",this.description=a.description||"",this.data=a.data||null,this.onUse=a.onUse||null,this.isCountLimited=void 0!==a.isCountLimited?a.isCountLimited:!0,this.maxPerInvSlot=a.maxPerInvSlot||1,this.storeName=a.storeName||a.displayName||a.name||"",this.baseCost=a.baseCost||100,this.currency=a.currency||"gold",this.researchCost=a.researchCost||0,this.prereqs=a.prereqs||null,this.count=a.count||0,this.isResearched=this.researchCost<=0||!1,this.getButtonHtml=function(){return getButtonHtml("Inventory.useItem('"+this.name+"')","<b>"+this.displayName+'</b>: <span id="count"></span>'+(this.isCountLimited?' / <span id="max-count"></span>':""),this.name+"-inv-button")},this.getStoreButtonHtml=function(){return'<div class="store-item" id="'+this.name+'">'+getButtonHtml("Inventory.tryPurchase('"+this.name+"')",'<b id="name"></b><br><span id="cost"></span> <span id="currency"></span>',"button")+' <span class="description"></span></div>'},this.updateButtons=function(){var a="#"+this.name+"-inv-button";j(a,"toggle",this.isVisible()),j(a+" #count","text",formatNumber(this.count)),j(a+" #max-count","text",formatNumber(this.maxItemCount()));var b=".store-item#"+this.name+" #button";j(b,"toggle",this.isVisibleInStore()),j(b,"toggleClass","inactive",!this.canMakeMore()),j(b+" #name","html",this.isResearched?this.storeName:"Research Item"),j(b+" span #cost","text",formatNumber(this.getCost())),j(b+" span #currency","html",getIconHtml(this.getCurrency())),j(".store-item#"+this.name+" .description","html",this.isResearched?this.description:"")},this.maxItemCount=function(){return this.maxPerInvSlot*Inventory.slotsPerItem},this.isItemMaxed=function(){return this.isCountLimited&&this.count>=this.maxItemCount()},this.isVisible=function(){return null!==this.onUse&&this.count>0},this.isVisibleInStore=function(){return prereqsMet(this.prereqs)},this.update=a.update||function(){},this.tryPurchase=function(){var a=this.getCost();this.canMakeMore()&&(Player[this.getCurrency()]-=a,this.onPurchase(),Inventory.updateButtons())},this.onPurchase=function(){this.isResearched?this.count+=1:this.isResearched=!0,this.update(),this.isLimitReached()&&(this.count=this.maxItemCount())},this.getCost=function(a,b){var c=b&&b.bind(a);return function(){return this.isResearched?c?c():this.baseCost:this.researchCost}}(this,a.getCost),this.getCurrency=function(){return this.isResearched?this.currency:"forge"},this.canAfford=function(){return this.getCost()<=Player[this.getCurrency()]},this.isLimitReached=a.isLimitReached||function(){return this.isItemMaxed()},this.canMakeMore=function(){return!AdventureScreen.isAdventuring()&&this.canAfford()&&!this.isLimitReached()}}function PotionDef(a){this.__proto__=new ItemDef(a),this.onUse=function(){Player.addHealth(Math.floor(this.data.healAmount*Player.itemEfficiency.value()))}}function loadStats(){var a={maxHealth:new StatType({displayName:"Health",baseCost:5,levelCost:2.5,baseValue:100,levelValue:10,getBaseValueAtLevel:function(a){return this.baseValue+a*(this.levelValue+a-1)},onUpgrade:function(){Player.regenHealth(this.upgradeValue())}}),strength:new StatType({displayName:"Strength",minLevel:2,baseCost:10,levelCost:5,baseValue:4}),defense:new StatType({displayName:"Defense",minLevel:5,baseCost:25,levelCost:5,baseValue:3}),itemEfficiency:new StatType({displayName:"Item Efficiency",minLevel:8,baseCost:100,levelCost:50,baseValue:100,levelValue:20,isPercent:!0}),healthRegen:new StatType({displayName:"Health Regen",minLevel:15,baseCost:400,levelCost:350,baseValue:1,levelValue:1,isPercent:!0,stringPostfix:"%/sec"})};for(var b in a)a[b].name=b;return a}function loadItems(){var a={potion:new PotionDef({displayName:"Potion",description:"Restores 100 HP",count:2,data:{healAmount:100},baseCost:250}),hiPotion:new PotionDef({displayName:"Hi-Potion",description:"Restores 500 HP",data:{healAmount:500},baseCost:5e3,researchCost:250,prereqs:{adventures:["adv1"]}}),megaPotion:new PotionDef({displayName:"Mega Potion",description:"Restores 2500 HP",data:{healAmount:500},baseCost:1e5,researchCost:5e3,prereqs:{adventures:["adv2"],items:["hiPotion"]}}),"armor-plus":new ItemDef({storeName:"Upgrade Armor",description:"Increases Armor by 1",isCountLimited:!1,update:function(){Player.armor=this.count+2},baseCost:50,currency:"forge",getCost:function(){return this.baseCost*(1+Math.floor(Math.pow(this.count,1.8)))}}),"inventory-plus":new ItemDef({storeName:"Raise Item Capacity",description:"Increases the number of items you can carry by 1",isCountLimited:!1,update:function(){Inventory.slotsPerItem=this.count+3},baseCost:500,currency:"forge",getCost:function(){return this.baseCost*Math.pow(10,this.count)}}),"forge-second":new ItemDef({storeName:"Increase "+getIconHtml("forge")+" per Second",description:"Gives passive "+getIconHtml("forge")+" over time",isCountLimited:!1,update:function(){Inventory.forgePerSecond=this.count},baseCost:250,getCost:function(){return Math.floor(this.baseCost*(1+2*Math.pow(this.count,2.5)))}})};for(var b in a)a[b].name=b;return a}function loadEnemies(){var a={enemy:new EnemyDef({displayName:"Snake",image:"img/Snake.png",health:22,gold:5}),wall:new EnemyDef({displayName:"Sloog",image:"img/SlugSquirrel.png",health:40,xp:4,forge:2,gold:6}),swirl:new EnemyDef({displayName:"Masker",image:"img/MaskBug.png",health:30,attack:6,xp:6,forge:3,gold:7}),snail:new EnemyDef({displayName:"Snale",image:"img/SpikeSnail.png",health:45,attack:6,xp:7,forge:2,gold:8})};return foreach(a,function(a,b){a.name=b}),a}function loadAdventures(){var a={adv0:new AdventureDef({displayName:"Field",levels:[2,2,3],enemies:["enemy"],spawnCountHi:3}),adv1:new AdventureDef({prereqs:{adventures:["adv0"]},displayName:"OtherField",levels:[4,6,6,8],enemies:["enemy","wall"]}),adv2:new AdventureDef({prereqs:{adventures:["adv1"]},displayName:"Third Area",levels:[12,16,18,18,18,22],enemies:["wall","swirl"]}),adv3:new AdventureDef({prereqs:{adventures:["adv2"]},displayName:"Oh shit there's more",levels:[24,26,24,28,32],enemies:["enemy","wall","swirl","snail"]})};for(var b in a)a[b].name=b;return a}function loadBuildings(){var a={tent:new BuildingDef({displayName:"Tent",baseCost:7500,goldPerSecond:6}),shack:new BuildingDef({displayName:"Shack",baseCost:4e4,researchCost:500,goldPerSecond:20,prereqs:{buildings:{tent:0}}}),cabin:new BuildingDef({displayName:"Cabin",baseCost:15e4,researchCost:2e3,goldPerSecond:65,prereqs:{buildings:{shack:0}}}),cottage:new BuildingDef({displayName:"Cottage",baseCost:35e4,researchCost:1e4,goldPerSecond:120,prereqs:{buildings:{cabin:0}}}),blacksmith:new BuildingDef({displayName:"Blacksmith",description:"Sells weapons",baseCost:500,maxCount:1}),anvil:new BuildingDef({displayName:"Anvil",description:"Blacksmith can Upgrade weapons",researchCost:1e3,baseCost:25e3,maxCount:1,prereqs:{buildings:{blacksmith:1}}}),forge:new BuildingDef({displayName:"Mystic Forge",description:"Blacksmith can Ascend max-level weapons",researchCost:5e3,baseCost:5e4,maxCount:1,prereqs:{buildings:{anvil:1}}})};return foreach(a,function(a,b){a.name=b}),a}function loadWeapons(){var a={knife:new WeaponDef({displayName:"Knife",owned:!0,damage:3,crit:9,upgradeData:{crit:10,critDamage:5}}),dagger:new WeaponDef({displayName:"Dagger",buyCost:500,damage:5,crit:8,upgradeData:{damage:5,critDamage:10}}),shortsword:new WeaponDef({displayName:"Shortsword",buyCost:1500,damage:7,crit:5,upgradeData:{damage:8,crit:5}}),longsword:new WeaponDef({displayName:"Longsword",buyCost:5e3,damage:9,crit:5,upgradeData:{damage:10,critDamage:5}}),rapier:new WeaponDef({displayName:"Rapier",buyCost:7500,damage:9,crit:7,upgradeData:{crit:5,defense:10}}),greatsword:new WeaponDef({displayName:"Greatsword",buyCost:15e3,damage:11,crit:4,upgradeData:{damage:15}})};return foreach(a,function(a,b){a.name=b}),a}function ParticleType(a){this.className=a.className||"",this.animHeight=a.animHeight||100,this.animTime=a.animTime||500}function StatType(a){this.toSave=["level"],this.name=a.name||"",this.displayName=a.displayName||this.name||"",this.minLevel=a.minLevel||0,this.baseValue=a.baseValue||0,this.levelValue=a.levelValue||1,this.baseCost=a.baseCost||0,this.levelCost=a.levelCost||0,this.isPercent=a.isPercent||!1,this.stringPostfix=a.stringPostfix||"",this.level=0,this.value=function(){var a=this.getBaseValue();return this.isPercent&&(a*=.01),a},this.getBaseValue=function(){return this.getBaseValueAtLevel(this.level)},this.getBaseValueAtLevel=a.getBaseValueAtLevel||function(a){return this.baseValue+a*this.levelValue},this.getStringPostfix=function(){return this.stringPostfix||(this.isPercent?"%":"")},this.stringValue=function(){return formatNumber(this.getBaseValue())+this.getStringPostfix()},this.upgradeCost=function(){return Math.ceil(this.baseCost+Math.pow(this.level,2.3)*this.levelCost)+Player.statUpgradeBaseCost()},this.upgradeValue=function(){return this.getBaseValueAtLevel(this.level+1)-this.getBaseValueAtLevel(this.level)},this.stringUpgradeValue=function(){return formatNumber(this.upgradeValue())+this.getStringPostfix()},this.canUpgrade=function(){return this.isPlayerMinLevel()&&Player.xp>=this.upgradeCost()},this.tryUpgrade=function(){return this.canUpgrade()?(Player.xp-=this.upgradeCost(),this.level++,this.onUpgrade(),Player.updateStatButtons(),!0):!1},this.isPlayerMinLevel=function(){return this.minLevel<=Player.getLevel()},this.getUpgradeButtonHtml=function(){var a=this.displayName+': <span id="amount"></span><br/><span id="upgrade">(+<span id="upgrade-amount"></span>) : <span id="cost"></span> '+getIconHtml("xp")+"</span>";return getButtonHtml("Player.upgrade('"+this.name+"')",a,"stat-"+this.name+"-button")},this.updateButton=function(){var a="#stat-"+this.name+"-button";j(a,"toggleClass","inactive",!this.canUpgrade()),j(a+" #upgrade","toggle",this.isPlayerMinLevel()),j(a+" #amount","text",this.stringValue()),j(a+" #upgrade-amount","text",this.stringUpgradeValue()),j(a+" #cost","text",formatNumber(this.upgradeCost()))},this.onUpgrade=a.onUpgrade||function(){}}function prereqsMet(a){var b;if(!a)return!0;if(a.items)for(b=0;b<a.items.length;b++)if(!Inventory.getItem(a.items[b]).isResearched)return!1;if(a.adventures)for(b=0;b<a.adventures.length;b++)if(!AdventureScreen.hasBeat(a.adventures[b]))return!1;if(a.buildings)for(b in a.buildings){var c=Village.buildings[b];if(c&&(!c.isResearched||c.count<a.buildings[b]))return!1}return!0}function AdventureDef(a){this.toSave=["beatOnPower","power"],this.prereqs=a.prereqs||null,this.name=a.name||"",this.displayName=a.displayName||"",this.levels=a.levels||[1],this.enemies=a.enemies||[],this.spawnCountLo=a.spawnCountLo||3,this.spawnCountHi=a.spawnCountHi||5,this.powerCost=a.powerCost||100,this.beatOnPower=-1,this.power=0,this.update=function(){var a="#"+this.name+"-button",b="#"+this.name+"-power";j(a,"toggle",this.isAvailable()),j(b,"toggle",this.isAvailable()),this.isAvailable()&&(j(a,"toggleClass","selected",this.power<=this.beatOnPower),j(b+"-count","text",formatNumber(this.power)),j(b+"-dec","toggle",this.power>0),j(b+"-inc","toggle",this.power<=this.beatOnPower),j(b+"-inc-cost","text",formatNumber(this.powerUpCost())))},this.isAvailable=function(){return prereqsMet(this.prereqs)},this.getLevel=function(a){var b=this.levels[a]||1;return Math.ceil(b*(1+.25*this.power)+2.5*this.power)},this.powerUpCost=function(){return this.powerCost*Math.pow(this.power+1,2)}}function mapSelectHtml(){var a="";return foreach(AdventureScreen.screens,function(b){"field"!=b.name&&"map-select"!=b.name&&(a+=getButtonHtml("AdventureScreen.setScreen('"+b.name+"')",b.displayName,b.name+"-button")+" ")}),a+="<br>",foreach(AdventureScreen.adventures,function(b){a+=getButtonHtml("AdventureScreen.startAdventure('"+b.name+"')",b.displayName,b.name+"-button")+" "}),a}function shrineHtml(){var a=getButtonHtml("AdventureScreen.setScreen('map-select')","Leave");for(var b in AdventureScreen.adventures){var c=AdventureScreen.adventures[b],d=c.name+"-power";a+='<div id="'+d+'">'+getButtonHtml("AdventureScreen.decreasePower('"+c.name+"')","Decrease Power",d+"-dec")+" <span>"+c.displayName+' : Power <span id="'+d+'-count"></span></span> '+getButtonHtml("AdventureScreen.increasePower('"+c.name+"')",'Increase Power<br><span id="'+d+'-inc-cost"></span>'+getIconHtml("gold"),d+"-inc")+"</div>"}return a}function WeaponDef(a){this.toSave=["owned","level","ascensions"],this.name=a.name||"",this.displayName=a.displayName||"",this.damage=a.damage||2,this.crit=a.crit||5,this.ascendDamage=a.ascendDamage||1,this.buyCost=a.buyCost||1e3,this.upgradeCost=a.upgradeCost||75e3,this.upgradeData=a.upgradeData||{damage:10},this.ascendCost=a.ascendCost||5e3,this.owned=a.owned||!1,this.level=0,this.ascensions=0,this.getUpgradeAmount=function(a){var b=this.upgradeData[a];return b?(this.level+1)*b:0},this.getBaseDamage=function(){return this.damage+this.ascensions*this.ascendDamage},this.get=function(a){return this[a]*(1+this.getUpgradeAmount(a)/100)},this.getMaxLevel=function(){return 4+this.ascensions},this.isMaxLevel=function(){return this.level>=this.getMaxLevel()},this.getCost=function(){return this.owned?this.isMaxLevel()?this.ascendCost*Math.pow(this.ascensions+1,3):Math.floor(this.upgradeCost*Math.pow(this.level+1,.5)*(2*this.ascensions+1)):this.buyCost},this.getCurrency=function(){return this.owned&&this.isMaxLevel()?"forge":"gold"},this.canPurchase=function(){return!AdventureScreen.isAdventuring()&&Player[this.getCurrency()]>=this.getCost()},this.purchase=function(){this.owned?this.isMaxLevel()?(this.ascensions+=1,this.level=0):this.level+=1:this.owned=!0},this.getButtonHtml=function(){return'<div class="weapon-container" id="'+this.name+'">'+getButtonHtml("Blacksmith.equip('"+this.name+"')","Equip "+this.displayName+' <span id="level"></span>',"equip")+" "+getButtonHtml("Blacksmith.tryPurchase('"+this.name+"')",'<span id="action"></span> '+this.displayName+'<br><span id="cost"></span>',"button")+'<span id="description"></span></div>'},this.updateButton=function(){var a=".weapon-container#"+this.name,b=this.name==Player.weaponName;j(a+" #equip","toggle",this.owned),j(a+" #equip","toggleClass","inactive",AdventureScreen.isAdventuring()&&!b),j(a+" #equip","toggleClass","selected",b);var c=null;this.owned&&(c={buildings:{anvil:1}}),this.isMaxLevel()&&(c={buildings:{forge:1}}),j(a+" #button","toggle",prereqsMet(c)),j(a+" #button","toggleClass","inactive",!this.canPurchase());var d="Buy";this.isMaxLevel()?d="Ascend":this.owned&&(d="Upgrade"),j(a+" #action","text",d);var e="";this.level>0&&(e+="("+this.level+"/"+this.getMaxLevel()+")"),this.ascensions>0&&(e="+"+this.ascensions+" "+e),j(a+" #level","text",e),j(a+" #cost","html",formatNumber(this.getCost())+" "+getIconHtml(this.getCurrency()));var f="Damage: "+this.getBaseDamage()+" Base Crit: "+this.crit+"%";for(var g in this.upgradeData)f+=", "+this.upgradeNames[g]+": +"+this.getUpgradeAmount(g)+"%";j(a+" #description","text",f)}}function ScreenDef(a){this.name=a.name||"",this.displayName=a.displayName||a.name||"",this.html=a.html||"",this.createHtml=a.createHtml||function(){return this.html},this.prereqs=a.prereqs||null}function ScreenContainer(a){this.screens=a.screens||[],this.classBase=a.classBase||"screen",this.targetDiv=a.targetDiv||".main-area",this.curScreen="",this.init=function(){this.preInit();for(var a="",b=0;b<this.screens.length;b++){var c=this.screens[b];a+='<div class="'+this.classBase+" "+c.name+'">'+c.createHtml()+"</div>"}$(this.targetDiv).html(a),this.postInit(),this.screens.length>0&&this.setScreen(this.screens[0].name)},this.preInit=a.preInit||function(){},this.postInit=a.postInit||function(){},this.update=a.update||function(){},this.setScreen=function(a){j("."+this.classBase).hide(),j("."+a).show(),this.onScreenSet(a),this.curScreen=a},this.onScreenSet=a.onScreenSet||function(){},this.isOpen=function(a){return this.curScreen==a}}function BuildingDef(a){this.toSave=["count"],this.name=a.name||"",this.displayName=a.displayName||"",this.description=a.description||"",this.baseCost=a.baseCost||1e4,this.researchCost=a.researchCost||0,this.prereqs=a.prereqs||null,this.maxCount=a.maxCount||0,this.goldPerSecond=a.goldPerSecond||0,this.count=0,this.isResearched=0===this.researchCost||!1,this.getButtonHtml=function(){return this.name+"-button",'<div id="'+this.name+'-building">'+getButtonHtml("Village.buyBuilding('"+this.name+"')",'<b id="name"></b> : <span id="count"></span><br><span id="cost"></span>',"button")+' <span id="description""></span></div>'},this.updateButton=function(){var a="#"+this.name+"-building";j(a,"toggle",this.isVisible()),j(a+" #name","text",this.isResearched?this.displayName:"Research Building"),j(a+" #button","toggleClass","inactive",!this.canAfford()),j(a+" #count","text",formatNumber(this.count)),j(a+" #cost","html",formatNumber(this.getCost())+" "+getIconHtml(this.getCurrency())),j(a+" #description","html",this.isResearched?this.description?this.description:"+"+this.goldPerSecond+" "+getIconHtml("gold")+"/s":"")},this.isVisible=function(){return prereqsMet(this.prereqs)&&(!this.maxCount||this.count<this.maxCount)},this.getCost=function(){return this.isResearched?Math.ceil(this.baseCost*Math.pow(1.1,this.count)):this.researchCost},this.getCurrency=function(){return this.isResearched?"gold":"forge"},this.canAfford=function(){return Player[this.getCurrency()]>=this.getCost()},this.getGPS=function(){return this.goldPerSecond}}function rand(a,b){return Math.random()*(b-a)+a}function randInt(a,b){return Math.floor(rand(a,b))}function randIntInc(a,b){return randInt(a,b+1)}function randItem(a){return a[randInt(0,a.length)]}function clamp(a,b,c){return Math.max(b,Math.min(c,a))}function clamp01(a){return clamp(a,0,1)}function removeItem(a,b){var c=b.indexOf(a);return c>=0?(b.splice(c,1),!0):!1}function formatNumber(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.length>1&&(b[1]=b[1].slice(0,2)),b.join(".")}function getButtonHtml(a,b,c){return idStr=c?' id="'+c+'"':"",'<span class="button" onclick="'+a+'"'+idStr+' ><span class="content">'+b+"</span></span>"}function foreach(a,b){for(var c in a)b(a[c],c)}EnemyManager={numEnemies:6,enemyDefs:{},curArea:null,enemies:[],activeEnemies:[],jqField:null,jqAdventure:null,subArea:0,bestAvailableSubArea:0,getAppropriateEnemy:function(){var a=[];for(var b in this.enemyDefs){var c=this.enemyDefs[b];this.curArea.enemies.indexOf(c.name)>=0&&a.push(c)}return randItem(a)},init:function(){this.jqField=$(".field"),this.jqAdventure=$(".adventure"),this.enemyDefs=loadEnemies(),this.curArea=AdventureScreen.adventures[0];var a="";a+='<h2 id="area-name"></h2>'+getButtonHtml("AdventureScreen.setScreen('map-select')","Map","map-button")+getButtonHtml("EnemyManager.decreaseLevel()","Back","dec-level")+getButtonHtml("EnemyManager.increaseLevel()","Forward","inc-level"),this.enemies=[];for(var b=0;b<this.numEnemies;b++){var c=new EnemyContainer(b);this.enemies.push(c),a+=c.getHtml()}this.jqField.html(a),$("#map-button").hide(),$(".enemy").click(function(){var a=$(this).attr("index");EnemyManager.enemies[a].onClick()})},resetField:function(){null!==this.curArea&&(this.subArea=0,this.bestAvailableSubArea=-1,this.spawnEnemies(),this.updateUI())},spawnEnemies:function(){this.activeEnemies=[];var a=Math.min(this.enemies.length,randIntInc(this.curArea.spawnCountLo,this.curArea.spawnCountHi));$(".enemy-container").hide();for(var b=0;a>b;b++){var c=this.enemies[b];c.getSelector().show(),c.respawn(this.getAppropriateEnemy()),this.activeEnemies.push(c)}},despawnEnemy:function(a){removeItem(a,this.activeEnemies),a.getSelector().hide(),0===this.activeEnemies.length&&(this.bestAvailableSubArea=Math.max(this.subArea+1,this.bestAvailableSubArea),this.bestAvailableSubArea>=this.curArea.levels.length&&(this.curArea.beatOnPower=Math.max(this.curArea.power,this.curArea.beatOnPower)),this.updateHeaderButtons(),this.spawnEnemies())},updateUI:function(){this.updateHeaderButtons()},updateHeaderButtons:function(){$("#area-name").text(this.curArea.displayName),$("#dec-level").toggle(this.subArea>0),$("#inc-level").toggle(this.subArea<this.bestAvailableSubArea).find(".content").text(this.subArea+1<this.curArea.levels.length?"Forward":"Area Complete")},decreaseLevel:function(){this.subArea--,this.spawnEnemies(),this.updateUI()},increaseLevel:function(){this.subArea+1<this.curArea.levels.length?(this.subArea++,this.spawnEnemies(),this.updateUI()):AdventureScreen.setScreen("map-select")}},$(document).ready(function(){Game.windowSize={width:$(window).width(),height:$(window).height()},$(".particles").html(ParticleContainer.getHtml()),Game.init(),$(window).resize(Game.handleResize)}),Game={toSave:["Player","Inventory","AdventureScreen","Save","Village","Blacksmith"],realtimeDt:33,normalDt:100,windowSize:null,init:function(){Log.init(),Menu.init(),EnemyManager.init(),Inventory.init(),Village.init(),Blacksmith.init(),Player.init(),Save.load(),window.setInterval(Game.update,Game.normalDt),Game.update()},update:function(){Player.update(),Inventory.update(),Village.update(),Blacksmith.update(),Menu.update(),AdventureScreen.update(),Save.update()},handleResize:function(){for(var a={width:Math.max($(window).width(),500),height:Math.max($(window).height(),500)},b=0;b<EnemyManager.enemies.length;b++)EnemyManager.enemies[b].handleResize(a);Game.windowSize=a}},Inventory={toSave:["items"],items:{},slotsPerItem:3,forgePerSecond:0,partialForge:0,init:function(){this.items=loadItems(),this.setupButtons()},postLoad:function(){for(var a in this.items)this.items[a].update()},update:function(){this.updateForge(),this.updateButtons()},updateForge:function(){var a=Game.normalDt/1e3;this.partialForge+=this.forgePerSecond*a;var b=Math.floor(this.partialForge);b>0&&(Player.forge+=b,this.partialForge-=b)},setupButtons:function(){var a="",b="";for(var c in this.items){var d=this.items[c];a+=d.getButtonHtml(),b+=d.getStoreButtonHtml()}j(".inventory").html(a),j(".recipes").html(b)},updateButtons:function(){for(var a in this.items){var b=this.items[a];b.updateButtons()}},getItem:function(a){return this.items[a]},useItem:function(a){var b=this.getItem(a);b&&b.count>0&&b.onUse&&(b.count-=1,b.onUse(),this.updateButtons())},tryPurchase:function(a){this.getItem(a).tryPurchase()}};var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(a){if(null==a)return"";var b,c,d,e,f,g,h,i="",j=0;for(a=this.compress(a);j<2*a.length;)0==j%2?(b=a.charCodeAt(j/2)>>8,c=255&a.charCodeAt(j/2),d=j/2+1<a.length?a.charCodeAt(j/2+1)>>8:0/0):(b=255&a.charCodeAt((j-1)/2),(j+1)/2<a.length?(c=a.charCodeAt((j+1)/2)>>8,d=255&a.charCodeAt((j+1)/2)):c=d=0/0),j+=3,e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decompressFromBase64:function(a){if(null==a)return"";var b,c,d,e,f,g,h,i,j="",k=0,l=0,m=this._f;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)f=this._keyStr.indexOf(a.charAt(l++)),g=this._keyStr.indexOf(a.charAt(l++)),h=this._keyStr.indexOf(a.charAt(l++)),i=this._keyStr.indexOf(a.charAt(l++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,0==k%2?(b=c<<8,64!=h&&(j+=m(b|d)),64!=i&&(b=e<<8)):(j+=m(b|c),64!=h&&(b=d<<8),64!=i&&(j+=m(b|e))),k+=3;return this.decompress(j)},compress:function(a){if(null==a)return"";var b,c,d,e={},f={},g="",h="",i="",j=2,k=3,l=2,m="",n=0,o=0,p=this._f;for(d=0;d<a.length;d+=1)if(g=a.charAt(d),Object.prototype.hasOwnProperty.call(e,g)||(e[g]=k++,f[g]=!0),h=i+g,Object.prototype.hasOwnProperty.call(e,h))i=h;else{if(Object.prototype.hasOwnProperty.call(f,i)){if(i.charCodeAt(0)<256){for(b=0;l>b;b++)n<<=1,15==o?(o=0,m+=p(n),n=0):o++;for(c=i.charCodeAt(0),b=0;8>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}else{for(c=1,b=0;l>b;b++)n=n<<1|c,15==o?(o=0,m+=p(n),n=0):o++,c=0;for(c=i.charCodeAt(0),b=0;16>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}j--,0==j&&(j=Math.pow(2,l),l++),delete f[i]}else for(c=e[i],b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;j--,0==j&&(j=Math.pow(2,l),l++),e[h]=k++,i=String(g)}if(""!==i){if(Object.prototype.hasOwnProperty.call(f,i)){if(i.charCodeAt(0)<256){for(b=0;l>b;b++)n<<=1,15==o?(o=0,m+=p(n),n=0):o++;for(c=i.charCodeAt(0),b=0;8>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}else{for(c=1,b=0;l>b;b++)n=n<<1|c,15==o?(o=0,m+=p(n),n=0):o++,c=0;for(c=i.charCodeAt(0),b=0;16>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}j--,0==j&&(j=Math.pow(2,l),l++),delete f[i]}else for(c=e[i],b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;j--,0==j&&(j=Math.pow(2,l),l++)}for(c=2,b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;for(;;){if(n<<=1,15==o){m+=p(n);break}o++}return m},decompress:function(a){if(null==a)return"";var b,c,d,e,f,g,h,i,j=[],k=4,l=4,m=3,n="",o="",p=this._f,q={string:a,val:a.charCodeAt(0),position:32768,index:1};for(c=0;3>c;c+=1)j[c]=c;for(e=0,g=Math.pow(2,2),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;switch(b=e){case 0:for(e=0,g=Math.pow(2,8),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;i=p(e);break;case 1:for(e=0,g=Math.pow(2,16),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;i=p(e);break;case 2:return""}for(j[3]=i,d=o=i;;){if(q.index>q.string.length)return"";for(e=0,g=Math.pow(2,m),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;switch(i=e){case 0:for(e=0,g=Math.pow(2,8),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;j[l++]=p(e),i=l-1,k--;break;case 1:for(e=0,g=Math.pow(2,16),h=1;h!=g;)f=q.val&q.position,q.position>>=1,0==q.position&&(q.position=32768,q.val=q.string.charCodeAt(q.index++)),e|=(f>0?1:0)*h,h<<=1;j[l++]=p(e),i=l-1,k--;break;case 2:return o}if(0==k&&(k=Math.pow(2,m),m++),j[i])n=j[i];else{if(i!==l)return null;n=d+d.charAt(0)}o+=n,j[l++]=d+n.charAt(0),k--,d=n,0==k&&(k=Math.pow(2,m),m++)}}};Log={maxLines:5,inUse:{},lastSet:0,init:function(){for(var a="",b=0;b<this.maxLines;b++)a+='<div class="log-message" id="'+b+'"></div>';j(".game-log").html(a)},write:function(a){for(var b=(this.lastSet-1+this.maxLines)%this.maxLines,c=this.maxLines-1;c>=0;c--)if(!this.inUse[c]){b=c;break}j(".log-message#"+b).text(a).stop(!0,!0).css({opacity:0}).animate({opacity:"1"},{duration:500}).animate({opacity:"1"},{duration:1e3}).animate({opacity:"0"},{duration:1e3,complete:function(){var a=$(this).attr("id");Log.inUse[a]=!1}}),this.lastSet=b,this.inUse[b]=!0}},ParticleContainer={curParticle:0,maxParticles:30,particles:[],getHtml:function(){for(var a="",b=0;b<this.maxParticles;b++)a+='<div id="particle-'+b+'"></div>';return a},create:function(a,b,c,d){for(;this.curParticle>=this.particles.length;){var e="#particle-"+this.curParticle;this.particles.push($(e))}var f=this.particles[this.curParticle];f.stop(!0,!0).html(b).css({left:100*c/Game.windowSize.width+"%",top:100*(d+64)/Game.windowSize.height+"%",opacity:1}).attr("class","particle "+a.className).animate({top:"-="+a.animHeight+"px",opacity:"0"},a.animTime),this.curParticle=(this.curParticle+1)%this.maxParticles}},damageParticleType=new ParticleType({className:"damage enemy-damage",animHeight:140,animTime:650}),critParticleType=new ParticleType({className:"damage enemy-crit",animHeight:160,animTime:650}),playerDamageParticleType=new ParticleType({className:"damage player-damage",animHeight:-90,animTime:850}),healParticleType=new ParticleType({className:"damage heal",animHeight:-75}),rewardParticleType=new ParticleType({className:"reward",animHeight:-70,animTime:1400}),forgeParticleType=new ParticleType({className:"damage forge-plus"}),getIconHtml=function(){var a={};return function(b){return a[b]||(a[b]='<img class="icon '+b+'-icon" />'),a[b]}}(),Player={toSave:["health","xp","gold","forge","weaponName"],health:100,partialHealth:0,xp:0,gold:0,forge:0,weaponName:"knife",weapon:null,armor:2,randDamage:.3,critDamage:150,stats:[],init:function(){var a=loadStats();for(var b in a)this.stats.push(b),this[b]=a[b],this.toSave.push(b);
this.createStatButtons(),j("#stats").html('<div>Level: <span id="stat-level"></span></div><div>'+getIconHtml("xp")+': <span id="stat-xp"></span></div><div>'+getIconHtml("gold")+': <span id="stat-gold"></span></div><div>'+getIconHtml("forge")+': <span id="stat-forge"></span></div><br/><div>Weapon : <span id="stat-weapon"></span></div><div>Damage : <span id="stat-damage"></span></div><div>Crit. Chance : <span id="stat-crit"></span></div><div>Crit Damage : <span id="stat-crit-damage"></span></div><br/><div>Armor : <span id="stat-armor"></span></div><br/><div>'+getIconHtml("forge")+' per Second: <span id="stat-forge-second"></span></div><div>'+getIconHtml("gold")+' per Second: <span id="stat-gold-second"></span></div><br/><div>Health Regen: <span id="stat-regen"></span></div><div>Damage Reduction: <span id="stat-reduction"></span></div><br/>'),this.update()},update:function(){var a=Game.normalDt/1e3;this.regenHealth(this.maxHealth.value()*this.healthRegen.value()*a),j("#player-health").text(formatNumber(this.health)+" / "+formatNumber(this.maxHealth.value())).css("width",100*(this.health/this.maxHealth.value())+"%"),this.weapon=Blacksmith.getWeapon(this.weaponName),this.updateStats(),this.updateStatButtons()},updateStats:function(){j("#stat-level","text",formatNumber(Player.getLevel())),j("#stat-xp","text",formatNumber(Player.xp)),j("#stat-gold","text",formatNumber(Player.gold)),j("#stat-forge","text",formatNumber(Player.forge)),j("#stat-weapon","text",this.weapon.displayName);var a=this.getDamageInfo();j("#stat-damage","text",formatNumber(a.lo)+" - "+formatNumber(a.hi)),j("#stat-crit","text",formatNumber(this.weapon.get("crit"))+"%"),j("#stat-crit-damage","text",formatNumber(this.getCritDamage())+"%"),j("#stat-armor","text",formatNumber(Player.armor)),j("#stat-forge-second","text",formatNumber(Inventory.forgePerSecond)),j("#stat-gold-second","text",formatNumber(Village.goldPerSecond)),j("#stat-regen","text","+"+formatNumber(this.maxHealth.value()*this.healthRegen.value())+"/s"),j("#stat-reduction","text",formatNumber(100*(1-this.defenseDamageMultiplier()))+"%")},getStat:function(a){return this[this.stats[a]]},getLevel:function(){for(var a=1,b=0;b<this.stats.length;b++)a+=this.getStat(b).level;return a},regenHealth:function(a){this.partialHealth+=a;var b=Math.floor(this.partialHealth);return this.partialHealth-=b,this.health=Math.min(this.health+b,this.maxHealth.value()),b},addHealth:function(a){this.regenHealth(a),this.createAddHealthParticle(a)},getDamageInfo:function(){var a={baseDamage:this.strength.value()*this.weapon.get("damage")};return a.lo=Math.ceil(a.baseDamage*(1-this.randDamage/2)),a.hi=Math.floor(a.baseDamage*(1+this.randDamage/2)),a.isCrit=rand(0,100)<this.weapon.get("crit"),a.damage=randIntInc(a.lo,a.hi),a.isCrit&&(a.damage=Math.floor(a.damage*this.getCritDamage()/100)),a},getCritDamage:function(){return this.critDamage+this.weapon.getUpgradeAmount("critDamage")},defenseDamageMultiplier:function(){var a=28;return a/(a+this.defense.value()*(1+this.weapon.getUpgradeAmount("defense")/100))},takeDamage:function(a){var b=Math.ceil(a*this.defenseDamageMultiplier())-this.armor;return b=Math.max(b,1),b>=this.health?!1:(this.health-=b,this.createAddHealthParticle(-b),!0)},createAddHealthParticle:function(a){var b=$("#player-health"),c=b.position(),d=b.width(),e=b.height(),f=c.left+d-8,g=c.top+e/2,h=a>0?healParticleType:playerDamageParticleType,i=a>0?"+":"";ParticleContainer.create(h,i+formatNumber(a),f,g)},upgrade:function(a){for(var b=0;b<this.stats.length;b++){var c=this.getStat(b);c.name==a&&c.tryUpgrade()}},createStatButtons:function(){for(var a="",b=0;b<this.stats.length;b++)a+=this.getStat(b).getUpgradeButtonHtml()+"<br/>";$("#stat-buttons").html(a),this.updateStatButtons()},updateStatButtons:function(){for(var a=0;a<this.stats.length;a++)this.getStat(a).updateButton()},statUpgradeBaseCost:function(){return Math.floor(1.5*Math.pow(this.getLevel()-1,1.7))}},Save={toSave:["autosave"],autosave:!0,autoDt:3e4,autoTimer:0,update:function(){this.autosave&&(this.autoTimer+=Game.normalDt,this.autoTimer>=this.autoDt&&(this.autoTimer-=this.autoDt,this.save()))},getSaveObject:function(a){if(null===a)return null;var b=a.toSave||Object.keys(a),c={};for(var d in a)(b[d]||!b.indexOf||b.indexOf(d)>=0)&&(c[d]="object"==typeof a[d]?this.getSaveObject(a[d]):a[d]);return c},restoreFromSaveObject:function(a,b){if(a&&b){var c=a.toSave||Object.keys(a);for(var d in b)(c[d]||!c.indexOf||c.indexOf(d)>=0)&&("object"==typeof a[d]?this.restoreFromSaveObject(a[d],b[d]):a[d]=b[d])}},save:function(){localStorage.saveString=this.getSaveString(),Log.write("Game Saved")},getFullSaveObject:function(){for(var obj={saveVersion:0},i=0;i<Game.toSave.length;i++){var key=Game.toSave[i];obj[key]=this.getSaveObject(eval(key))}return obj},getPreHashSaveString:function(){return JSON.stringify(this.getFullSaveObject())},getSaveString:function(){return LZString.compressToBase64(this.getPreHashSaveString())},getSavedString:function(){return localStorage.saveString},saveExists:function(){return localStorage.saveString?!0:!1},clearSave:function(){delete localStorage.saveString},load:function(){localStorage.saveString&&Save.import(localStorage.saveString)},"import":function(str){if(str&&""!==str){var baseStr=LZString.decompressFromBase64(str);if(null===baseStr||""===baseStr)return alert("Load failed! Invalid import string"),void 0;try{for(var restoredObject=JSON.parse(baseStr),i=0;i<Game.toSave.length;i++){var key=Game.toSave[i],obj=eval(key);this.restoreFromSaveObject(obj,restoredObject[key]),obj.postLoad&&obj.postLoad()}}catch(exception){alert("Load failed! Unparseable save data")}}}},AdventureScreen=new ScreenContainer({classBase:"adventure-screen",targetDiv:".adventure",screens:[new ScreenDef({name:"map-select",createHtml:mapSelectHtml}),new ScreenDef({name:"field"}),new ScreenDef({name:"inn",displayName:"Inn",html:getButtonHtml("AdventureScreen.setScreen('map-select')","Leave")+"<br>"+getButtonHtml("AdventureScreen.useInn()",'Rest: <span id="inn-cost"></span>'+getIconHtml("gold"))}),new ScreenDef({name:"shrine",displayName:"Shrine",createHtml:shrineHtml})],adventures:{},preInit:function(){this.adventures=loadAdventures()},update:function(){j("#map-button","toggle",this.hasBeat("adv0")),j("#shrine-button","toggle",this.hasBeat("adv2")),j("#inn-cost","text",formatNumber(this.getInnCost()));for(var a in this.adventures)this.adventures[a].update()},onScreenSet:function(a){this.isOpen("field")||"field"!=a||EnemyManager.resetField(),this.curScreen=a}}),AdventureScreen.toSave=["adventures"],AdventureScreen.postLoad=function(){this.hasBeat("adv0")||this.startAdventure("adv0")},AdventureScreen.getAdventure=function(a){for(var b in this.adventures){var c=this.adventures[b];if(c.name==a)return c}return null},AdventureScreen.hasBeat=function(a){var b=this.getAdventure(a);return b&&b.beatOnPower>=0},AdventureScreen.startAdventure=function(a){var b=this.getAdventure(a);EnemyManager.curArea=b,this.setScreen("field")},AdventureScreen.increasePower=function(a){var b=this.getAdventure(a);Player.gold>=b.powerUpCost()&&(Player.gold-=b.powerUpCost(),b.power++)},AdventureScreen.decreasePower=function(a){var b=this.getAdventure(a);b.power>0&&b.power--},AdventureScreen.useInn=function(){Player.gold>=this.getInnCost()&&Player.health<Player.maxHealth.value()&&(Player.gold-=this.getInnCost(),Player.health=Player.maxHealth.value())},AdventureScreen.getInnCost=function(){return Math.floor(30*Math.pow(Player.maxHealth.value()/100,1.25))},AdventureScreen.isAdventuring=function(){return"field"==this.curScreen},Blacksmith={toSave:["weapons"],weapons:{},init:function(){this.weapons=loadWeapons(),this.setupButtons()},update:function(){this.updateButtons()},setupButtons:function(){var a="";foreach(this.weapons,function(b){a+=b.getButtonHtml()}),j(".blacksmith").html(a),this.updateButtons()},updateButtons:function(){foreach(this.weapons,function(a){a.updateButton()})},getWeapon:function(a){return this.weapons[a]},equip:function(a){this.getWeapon(a).owned&&!AdventureScreen.isAdventuring()&&(Player.weaponName=a)},tryPurchase:function(a){var b=this.getWeapon(a);b.canPurchase()&&(Player[b.getCurrency()]-=b.getCost(),b.purchase(),Player.weaponName=a)}},WeaponDef.prototype.upgradeNames={damage:"Damage",crit:"Crit. Chance",critDamage:"Crit. Damage",defense:"Defense"},Menu=new ScreenContainer({screens:[new ScreenDef({name:"adventure",displayName:"Adventure"}),new ScreenDef({name:"store",displayName:"Store",html:'<div class="recipes"></div>',prereqs:{adventures:["adv0"]}}),new ScreenDef({name:"blacksmith",displayName:"Blacksmith",prereqs:{buildings:{blacksmith:1}}}),new ScreenDef({name:"village",displayName:"Village",prereqs:{adventures:["adv1"]}}),new ScreenDef({name:"options",displayName:"Options",html:getButtonHtml("Save.save()","Save")+" "+getButtonHtml("Save.autosave = !Save.autosave",'Autosave: <span id="save-autosave"></span>')+'<span id="save-info"><br/>'+getButtonHtml("Save.clearSave()","Delete Save","del-save")+'<br/>Export hash: <textarea disabled id="save-val"></textarea></span><br/>'+getButtonHtml("Save.import($('#save-import').val())","Import")+'Import hash: <textarea id="save-import"></textarea>'})],classBase:"screen",targetDiv:".main-area",postInit:function(){var a="";foreach(this.screens,function(b){a+=getButtonHtml("Menu.setScreen('"+b.name+"')",b.displayName,b.name+"-button")+" "}),j(".header-container").html(a),this.setScreen("adventure"),AdventureScreen.init()},update:function(){j("#save-info","toggle",Save.saveExists());var a=j("#save-val");a.text()!=Save.getSavedString()&&a.text(Save.getSavedString()),j("#save-autosave","text",Save.autosave?"Enabled":"Disabled"),foreach(this.screens,function(a){j("#"+a.name+"-button","toggle",prereqsMet(a.prereqs))})},onScreenSet:function(a){j("#"+this.curScreen+"-button").toggleClass("selected",!1),j("#"+a+"-button").toggleClass("selected",!0)}}),Village={toSave:["buildings"],buildings:{},goldPerSecond:0,partialGold:0,init:function(){this.buildings=loadBuildings(),this.setupButtons(),this.refreshGPS()},postLoad:function(){this.refreshGPS()},update:function(){this.updateButtons();var a=Game.normalDt/1e3;this.partialGold+=this.goldPerSecond*a;var b=Math.floor(this.partialGold);Player.gold+=b,this.partialGold-=b},setupButtons:function(){var a="";foreach(this.buildings,function(b){a+=b.getButtonHtml()}),j(".village").html(a)},updateButtons:function(){foreach(this.buildings,function(a){a.updateButton()})},refreshGPS:function(){this.goldPerSecond=0,foreach(this.buildings,function(a){Village.goldPerSecond+=a.count*a.getGPS()})},buyBuilding:function(a){var b=this.buildings[a];b.canAfford()&&(Player[b.getCurrency()]-=b.getCost(),b.isResearched?b.count+=1:b.isResearched=!0,this.refreshGPS())}},j=function(){var a={};return function(b){if(1==arguments.length)return b in a||(a[b]=$(b)),a[b];for(var c=arguments[1],d=b+"#"+c,e=[],f=2;f<arguments.length;f++)e.push(arguments[f]);if(a[d]!==e.toString()){a[d]=e.toString();var g=j(b)[c];g.apply(j(b),e)}}}();